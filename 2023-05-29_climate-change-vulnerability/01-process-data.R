# Data from: https://climateknowledgeportal.worldbank.org/country/peru

library(tidyverse)
library(fs)

raw_files <- dir_ls("2023-05-29_climate-change-vulnerability/", regexp = "pr_.+.csv")

raw_df <- read_csv(
  raw_files,
  skip = 2,
  col_names = c(
    "region",
    "annual",
    month.abb
  ),
  col_types = cols(
    .default = col_number(),
    region = col_character()
  ),
  id = "period"
) %>%
  mutate(
    period = str_remove(
      period,
      fixed("2023-05-29_climate-change-vulnerability/pr_climatology_annual-monthly_cru_")
    ) %>%
      str_remove(
        fixed("_PER.csv")
      ),
    region = str_to_upper(region)
  ) %>%
  janitor::clean_names()

saveRDS(raw_df,
        "2023-05-29_climate-change-vulnerability/precipitation-peru.rds")

regions_annual_rain_df <- raw_df %>%
  filter(region != "PERU") %>%
  select(period, region, annual)

saveRDS(regions_annual_rain_df,
        "2023-05-29_climate-change-vulnerability/precipations-regions-peru.rds")

